<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TechBit - VPS Pricing (QRIS Ready)</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{ --accent1:#9333ea; --accent2:#06b6d4; --bg1:#1a1a2e; --bg2:#16213e; }
  *{box-sizing:border-box}
  body{
    font-family:'Orbitron',sans-serif;
    margin:0;padding:0;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    color:#fff;
  }
  .container{max-width:1200px;margin:28px auto;padding:20px;}
  h2{
    text-align:center;
    background:linear-gradient(to right,#a855f7,#22d3ee);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    font-size:34px;margin:4px 0 20px;
  }
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
  .card{
    background:rgba(255,255,255,0.06);padding:18px;border-radius:12px;text-align:center;border:1px solid rgba(255,255,255,0.06);
  }
  .card h3{margin:4px 0 8px;font-size:18px}
  .card p{margin:0;font-weight:700}
  .btn{
    display:inline-block;margin-top:12px;padding:10px 16px;border-radius:10px;
    background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;cursor:pointer;text-decoration:none;
  }
  .old-price{
    text-decoration:line-through;color:#9ca3af;font-size:0.9em;margin-right:8px;
  }
  .new-price{
    color:#22d3ee;font-size:1.2em;
  }
  .promo-note, .contact-info{
    text-align:center;margin-top:20px;
  }
  .promo-note{
    padding:10px;background:rgba(6, 182, 212, 0.2);border-radius:8px;
  }
  .popup{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:9999}
  .popup-content{width:92%;max-width:480px;background:#0b1220;border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
  .popup h3{text-align:center;margin:0 0 10px}
  .qr-wrap{display:flex;flex-direction:column;align-items:center;gap:8px}
  #qrImage{
    width:300px; height:auto; max-width:90%;
    image-rendering:pixelated; image-rendering:-moz-crisp-edges; image-rendering:-webkit-optimize-contrast;
    border-radius:6px; background:#fff; padding:6px;
  }
  .row{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px}
  .close-btn{background:#ef4444;padding:8px 10px;border-radius:8px;color:#fff;cursor:pointer}
  #apiDetails{margin-top:12px;background:#071026;padding:10px;border-radius:8px;font-size:13px;line-height:1.4;color:#d1d5db}
  #apiDetails a{color:#60a5fa;word-break:break-all}
  .config-form{display:none;margin-top:10px;text-align:left}
  .config-form label{display:block;margin-top:8px;font-size:13px}
  .config-form input,.config-form select{width:100%;padding:8px;background:#07132a;border:1px solid rgba(255,255,255,0.06);color:#fff;border-radius:6px;margin-top:6px}
  .muted{color:#94a3b8;font-size:13px}
  @media(max-width:520px){
    #qrImage{width:260px}
  }
</style>
</head>
<body>
  <div class="container">
    <h2>VPS Pricing</h2>
    <div class="grid" id="plansGrid"></div>
    <div class="promo-note">
      <p><strong>Catatan Promo:</strong> Diskon ini hanya berlaku dari 11 Agustus 2025-18 Agustus 2025. Setelah itu, harga akan kembali normal.</p>
    </div>
    <div class="contact-info">
      <p><strong>Hubungi Kami:</strong></p>
      <p>ðŸ“± t.me/betabotz</p>
    </div>
  </div>
  <div class="popup" id="popup">
    <div class="popup-content" role="dialog" aria-modal="true">
      <h3 id="popupTitle">Scan QR untuk Membayar</h3>
      <div class="qr-wrap">
        <img id="qrImage" src="" alt="QR Code - scan untuk membayar" />
        <div class="row">
          <a id="downloadQR" class="btn" href="#" download="qris.png">Unduh Gambar</a>
          <button class="btn" id="openUrlBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.08)">Buka di Tab</button>
          <button class="btn" id="okPaidBtn">Sudah Bayar</button>
          <button class="close-btn" id="closePopupBtn">Tutup</button>
        </div>
      </div>
      <div id="apiDetails" aria-live="polite"></div>
      <div class="config-form" id="configForm">
        <label>Operating System</label>
        <select id="osSelect">
          <option>Ubuntu 24.04</option>
          <option>Ubuntu 22.04</option>
          <option>Debian 12</option>
          <option>CentOS 9</option>
        </select>
        <label>Subdomain</label>
        <input id="subdomain" placeholder="yourserver.techbit.com" />
        <label>Root Password</label>
        <input id="rootPass" type="password" />
        <label>Negara</label>
        <select id="countrySelect">
          <option>Singapore</option>
          <option>United States</option>
          <option>Germany</option>
        </select>
        <div style="text-align:right;margin-top:10px">
          <button class="btn" id="sendConfigBtn">Kirim Konfigurasi</button>
        </div>
      </div>
    </div>
  </div>
<script>
const plans = [
  {name:'Starter 1', amount:7200, oldAmount:9000, specs:'RAM 1GB, DISK 1.5GB, CPU 50%'},
  {name:'Starter 2', amount:9600, oldAmount:12000, specs:'RAM 1.5GB, DISK 2GB, CPU 65%'},
  {name:'Starter 3', amount:12800, oldAmount:16000, specs:'RAM 2GB, DISK 3GB, CPU 75%'},
  {name:'Pro 1', amount:16000, oldAmount:20000, specs:'RAM 3.5GB, DISK 4.5GB, CPU 100%'},
  {name:'Pro 2', amount:21600, oldAmount:27000, specs:'RAM 4.5GB, DISK 5GB, CPU 130%'},
  {name:'Ultra 1', amount:25600, oldAmount:32000, specs:'RAM 5GB, DISK 7GB, CPU 180%'},
  {name:'Ultra 2', amount:41600, oldAmount:52000, specs:'RAM 6GB, DISK 11GB, CPU Unlimited'}
];

const grid = document.getElementById('plansGrid');
grid.innerHTML = '';
plans.forEach(p=>{
  const card = document.createElement('div');
  card.className='card';
  card.innerHTML = `
    <h3>${p.name}</h3>
    <p><span class="old-price">~Rp${p.oldAmount.toLocaleString()}~</span><span class="new-price">Rp${p.amount.toLocaleString()}</span></p>
    <p>${p.specs}</p>
    <div class="btn" role="button" tabindex="0">Order Now</div>
  `;
  card.querySelector('.btn').addEventListener('click', ()=> orderNow(p));
  grid.appendChild(card);
});

const popup = document.getElementById('popup');
const qrImage = document.getElementById('qrImage');
const apiDetails = document.getElementById('apiDetails');
const downloadQR = document.getElementById('downloadQR');
const openUrlBtn = document.getElementById('openUrlBtn');
const closePopupBtn = document.getElementById('closePopupBtn');
const okPaidBtn = document.getElementById('okPaidBtn');
const configForm = document.getElementById('configForm');
let countdownInterval = null;
let currentTransaction = null;

function showPopup(){ popup.style.display='flex'; }
function hidePopup(){ popup.style.display='none'; clearInterval(countdownInterval); countdownInterval=null; }

function applyQrStyling(imgEl){
  try{
    const naturalW = imgEl.naturalWidth || 0;
    if(naturalW < 250){
      imgEl.style.width = '300px';
    } else {
      imgEl.style.width = '300px';
    }
    imgEl.style.imageRendering = 'pixelated';
  }catch(e){}
}

async function makeDownloadable(url){
  try{
    const res = await fetch(url, {mode:'cors'});
    if(!res.ok) throw new Error('fetch fail');
    const blob = await res.blob();
    const objUrl = URL.createObjectURL(blob);
    return {ok:true, url:objUrl};
  }catch(err){
    return {ok:false, url};
  }
}

function startCountdown(expirationISO){
  if(countdownInterval) clearInterval(countdownInterval);
  const expire = new Date(expirationISO).getTime();
  const elId = 'countdownVal';
  countdownInterval = setInterval(()=>{
    const now = Date.now();
    const diff = expire - now;
    const el = document.getElementById(elId);
    if(!el) return;
    if(diff <= 0){
      el.textContent = 'Expired';
      clearInterval(countdownInterval);
      countdownInterval = null;
    } else {
      const mins = Math.floor(diff / (1000*60));
      const secs = Math.floor((diff % (1000*60)) / 1000);
      el.textContent = `${mins}m ${secs}s`;
    }
  }, 500);
}

async function orderNow(plan){
  apiDetails.innerHTML = `<p class="muted">Membuat QR untuk <b>${plan.name}</b> â€” Rp ${plan.amount.toLocaleString()} ...</p>`;
  showPopup();

  const endpoint = `https://berak.vercel.app/orkut/create?amount=${plan.amount}&codeqr=00020101021126570011ID.DANA.WWW011893600915391487938702099148793870303UMI51440014ID.CO.QRIS.WWW0215ID10254060711550303UMI5204549953033605802ID5911TOKO KAIZEL6012Kab. Cirebon61054515663041183`;
  console.log('Memanggil API dengan URL:', endpoint);

  try{
    const res = await fetch(endpoint);
    const data = await res.json();
    console.log('Respons API diterima:', data);

    if(!data || !data.status || !data.result){
      const errorMessage = 'Gagal membuat QRIS. Respons tidak valid.';
      console.error(errorMessage, data);
      apiDetails.innerHTML = `<p class="muted">${errorMessage} Cek konsol untuk detail lebih lanjut.</p>`;
      qrImage.src = '';
      return;
    }
    currentTransaction = data.result;

    setTimeout(() => {
        const imgLoader = new Image();
        imgLoader.crossOrigin = 'anonymous';
        imgLoader.onload = async function(){
          qrImage.src = data.result.qrImageUrl;
          applyQrStyling(qrImage);

          const make = await makeDownloadable(data.result.qrImageUrl);
          downloadQR.href = make.url;
          openUrlBtn.onclick = ()=> window.open(data.result.qrImageUrl, '_blank');

          apiDetails.innerHTML = `
            <p><strong>URL API yang Dipanggil:</strong> <a href="${endpoint}" target="_blank" rel="noreferrer" style="word-break:break-all;">${endpoint}</a></p>
            <p><strong>Package:</strong> ${plan.name}</p>
            <p><strong>Transaction ID:</strong> ${data.result.transactionId || '-'} </p>
            <p><strong>Amount:</strong> Rp ${Number(data.result.amount).toLocaleString()}</p>
            <p><strong>Expiration Time:</strong> ${new Date(data.result.expirationTime).toLocaleString()}</p>
            <p><strong>Countdown:</strong> <span id="countdownVal">--</span></p>
            <p><strong>QR Image URL:</strong> <a href="${data.result.qrImageUrl}" target="_blank" rel="noreferrer" style="word-break:break-all;">${data.result.qrImageUrl}</a></p>
            <p class="muted">Tips: Pastikan scan sebelum countdown habis. Jika scanner gagal, perbesar ukuran layar atau unduh gambarnya dan scan dari file.</p>
          `;
          startCountdown(data.result.expirationTime);
        };
        imgLoader.onerror = function(){
          const errorMessage = 'Gagal memuat gambar QR dari server.';
          console.error(errorMessage, 'URL:', data.result.qrImageUrl);
          apiDetails.innerHTML = `<p class="muted">${errorMessage} Coba buka link manual:<br/><a href="${data.result.qrImageUrl}" target="_blank" rel="noreferrer">${data.result.qrImageUrl}</a></p>`;
          qrImage.src = '';
          openUrlBtn.onclick = ()=> window.open(data.result.qrImageUrl, '_blank');
          downloadQR.href = data.result.qrImageUrl;
        };
        imgLoader.src = data.result.qrImageUrl;
    }, 1000);
  }catch(err){
    console.error('Error saat membuat QRIS:', err);
    apiDetails.innerHTML = `<p class="muted">Error saat membuat QRIS: ${err.message}. Cek konsol untuk detail.</p>`;
    qrImage.src = '';
  }
}
closePopupBtn.addEventListener('click', ()=>{ hidePopup(); });
okPaidBtn.addEventListener('click', ()=>{ configForm.style.display='block'; });
document.getElementById('sendConfigBtn').addEventListener('click', ()=>{
  const cfg = {
    os: document.getElementById('osSelect').value,
    subdomain: document.getElementById('subdomain').value,
    rootPass: document.getElementById('rootPass').value,
    country: document.getElementById('countrySelect').value,
    transactionId: currentTransaction ? currentTransaction.transactionId : null
  };
  console.log('Kirim konfigurasi:', cfg);
  alert('Konfigurasi terkirim. Kami akan proses provisioning.');
  hidePopup();
});
window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') hidePopup(); });
</script>
</body>
</html>
